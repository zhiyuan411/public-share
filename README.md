# public-share

## 项目简介
公共交流区，匿名、临时发布文本，分享图片和任何文件附件。目的是方便地代替微信的文件传输助手在多台设备之间进行文本、图片和文件的传送。该项目特别适合部署在局域网环境（如 NAS），借助局域网内点对点传输的优势，实现大文件的高速共享。

## 功能特性
1. **文本发布**：支持多行和空格，文本按原始格式保存。
2. **图片上传**：支持 JPG、PNG、GIF 等格式，可设置图片大小限制。
3. **文件上传**：支持所有文件格式，可设置文件大小限制。
4. **过期清理**：可设置文本、图片和文件的过期时间，过期内容自动清理。
5. **内容复制**：支持复制文本、图片和全部内容到剪贴板。
6. **分页展示**：帖子列表支持分页展示，方便查看。
7. **用户信息显示**：可选择是否显示用户的浏览器、操作系统和 IP 地址。

## 技术栈
- **后端**：PHP（最低支持 PHP 5.3，因使用 SQLite3 扩展） + SQLite3
- **前端**：HTML + Tailwind CSS + JavaScript

## 安装与部署
### 环境要求
- PHP 环境（最低版本 **PHP 5.3**，需支持 SQLite3 扩展）
- SQLite3 扩展

### 步骤
1. **获取项目文件**  
   - **方法一（推荐）**：通过 Git 克隆项目（适合可联网的环境）
     ```bash
     git clone https://github.com/zhiyuan411/public-share.git
     ```
   - **方法二**：直接复制文件（适合局域网环境，如 NAS）  
     从 GitHub 下载 `index.php` 和 `admin.php.dist` 的源代码，手动上传到服务器目录。

2. **配置权限**  
   确保项目目录具有读写权限，`data`、`pic` 和 `file` 目录以及数据库会在首次访问时自动创建。

3. **重命名管理页面文件（可选）**  
   将 `admin.php.dist` 重命名为 `admin.php`，以启用可视化管理功能。**注意**：该操作仅建议在可信环境（如私有局域网）中进行，因为管理页面无密码保护。若在公共环境中使用，需在完成设置后将文件重命名回 `admin.php.dist`，以防未授权访问。

4. **访问项目**  
   通过浏览器访问 `index.php` 即可使用主功能，访问 `admin.php` 可进行管理设置。

## 使用说明
### 发布内容
1. 在“发布新内容”区域输入文本内容。
2. 点击“上传图片”或“上传文件”按钮，选择要上传的图片或文件。支持拖放操作，且选择的文件会进行去重处理。
3. 点击“发布”按钮，将内容提交到服务器。表单提交时会验证是否至少输入文本内容、上传图片或文件中的一项。

### 查看内容
在“最新消息”区域查看最新发布的内容，支持分页浏览。可在页面上下方的分页控制区域切换页面。

### 复制内容
- 点击“复制文本”按钮，会先尝试使用现代 Clipboard API 复制文本内容到剪贴板，若失败则回退到传统方法。
- 点击“复制图片”按钮，通过 Fetch API 获取图片的 Blob 数据，再使用 Clipboard API 复制图片，若失败会给出相应提示。
- 点击“复制全部”按钮，会收集帖子的时间、用户信息、文本内容、图片链接和文件链接，然后复制到剪贴板，同样优先使用现代 Clipboard API，失败则使用传统方法。

### 删除内容
点击“删除”按钮，会弹出确认提示框，确认后可删除该帖子及其相关的图片和文件。

## 可视化管理操作
### 访问管理页面
将 `admin.php.dist` 文件重命名为 `admin.php` 后，通过浏览器访问该文件，即可进入可视化管理页面。

### 统计信息查看
在管理页面的顶部，有三个统计卡片，分别展示了当前系统中的帖子总数、上传图片的数量及总大小、上传文件的数量及总大小，方便管理员快速了解系统的使用情况。

### 系统设置调整
管理页面的主要部分是系统设置表单，包含以下几个设置项：
1. **分页设置**
    - **每页显示数量**：设置首页展示区域每页显示的帖子数量，可输入 1 - 100 之间的整数。
    - **显示用户信息**：勾选该项后，在帖子中会显示发布者的浏览器、操作系统和 IP 信息。
2. **内容过期设置**
    - **文本过期时间 (天)**：设置文本内容的过期时间，输入 0 表示永不过期。
    - **图片过期时间 (天)**：设置图片的过期时间，输入 0 表示永不过期。
    - **文件过期时间 (天)**：设置文件的过期时间，输入 0 表示永不过期。
3. **上传限制设置**
    - **图片大小限制 (MB)**：设置上传图片的大小限制，输入 0 表示无限制。
    - **文件大小限制 (MB)**：设置上传文件的大小限制，输入 0 表示无限制。

### 保存设置
完成设置调整后，点击“保存设置”按钮，系统会验证输入的数值是否有效。如果输入无效，会弹出相应的提示框；如果输入有效，设置将被保存到数据库，页面会刷新并显示“设置已成功保存”的提示信息。

## 代码结构说明
### index.php
此文件是项目的核心文件，负责处理主要的业务逻辑和页面展示，具体功能如下：
1. **数据库初始化**：确保数据目录存在且可写，连接 SQLite3 数据库，若数据库文件是新建的，则初始化表结构并设置默认配置。涉及 `posts`、`images`、`files` 和 `settings` 四张表。
2. **过期内容清理**：根据配置的过期时间，自动清理过期的文本、图片和文件，并删除空帖子。
3. **发布请求处理**：处理用户的发布请求，包括文本内容、图片和文件的上传，并将相关信息存储到数据库中。上传的图片和文件会进行大小检查，超过限制的会被跳过。
4. **删除请求处理**：处理用户的删除请求，删除帖子及其相关的图片和文件。
5. **分页展示**：根据配置的每页显示数量，对帖子进行分页展示。
6. **前端页面展示**：使用 HTML、Tailwind CSS 和 JavaScript 构建前端页面，实现文本输入、图片和文件上传、内容展示、复制和删除等功能。同时支持拖放上传文件和图片，以及预览功能。

### admin.php.dist
`admin.php.dist` 文件是可视化管理页面的模板文件，其主要功能是为管理员提供一个方便的界面来管理系统的配置和查看统计信息。具体用途如下：
1. **配置管理**：管理员可以通过该页面调整系统的各项配置参数，如每页显示的帖子数量、是否显示用户信息、内容的过期时间以及上传文件的大小限制等。这些配置信息存储在 SQLite3 数据库的 `settings` 表中，通过表单提交的方式更新数据库中的记录。
2. **统计信息查看**：页面会显示当前系统中的帖子总数、上传图片的数量及总大小、上传文件的数量及总大小等统计信息，帮助管理员了解系统的使用情况。

在实际使用中，需要将 `admin.php.dist` 文件重命名为 `admin.php`。通过浏览器访问 `admin.php` 即可进入可视化管理页面。

## 局域网部署优势
本项目未使用任何 PHP 第三方库，仅依赖 PHP 内置的 SQLite3 扩展，因此兼容极低的 PHP 版本（最低 PHP 5.3）。这种设计特别适合部署在 NAS 等局域网设备上，无需复杂环境配置即可运行。在局域网环境中，文件共享通过点对点传输实现，速度仅受限于局域网带宽，大幅提升大文件传输效率。

## 安全注意事项
- 管理页面（`admin.php`）无密码保护，建议仅在可信环境（如私有局域网）中启用。
- 在公共环境中使用时，完成设置后务必将 `admin.php` 重命名回 `admin.php.dist`，防止未授权访问。

## 许可证
本项目采用 MIT 许可证，版权归 2025 李小白所有。详细信息请查看 [LICENSE](public-share/LICENSE) 文件。


## 贡献
如果你有任何建议或改进，请提交 Issues 或 Pull Requests。

## 联系信息
如果你有任何问题或者建议，可以通过以下方式联系我：
- GitHub: [zhiyuan411](https://github.com/zhiyuan411)
- Email: <zhiyuan411@gmail.com>
